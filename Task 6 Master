#include <Wire.h>

#define SLAVE_ADDR 0x08
const int buttonPin = 2;
const int ledPin = 8;

void setup() {
  pinMode(buttonPin, INPUT_PULLUP);
  pinMode(ledPin, OUTPUT);
  Serial.begin(115200); // Use higher baud to reduce serial interference

  Wire.begin(); // Call this FIRST

  // --- TASK 6 REGISTER OVERRIDE ---
  // Apply values AFTER Wire.begin()
  
  // Example for 25 kHz (Slow Mode): Set Prescaler to 4 (TWPS bits 01)
  TWSR = (TWSR & 0xFC) | 0x00; 
  TWBR = 12;                   // Set Bit Rate registe
  //For the 100kHz and 400kHz, prescaler should be 1 (TWPS bits 00)
  // TWBR for 25kHz: 78 with prescaler 4  
  // TWBR for 100kHz: 72
  // TWBR for 400kHz: 12


  Serial.println("Starting 50 message test...");
  runTimingTest();
}

void runTimingTest() {
  unsigned long startTime = millis();
  
  for (int i = 0; i < 50; i++) {
    // Write 1 byte
    Wire.beginTransmission(SLAVE_ADDR);
    Wire.write(0x01);
    Wire.endTransmission();

    // Read 1 byte
    Wire.requestFrom(SLAVE_ADDR, 1);
    while(Wire.available()) {
      Wire.read();
    }
  }
  
  unsigned long duration = millis() - startTime;
  Serial.print("Time for 50 exchanges: ");
  Serial.print(duration);
  Serial.println(" ms");
}

void loop() {
  // Empty or standard Task 5 logic
}
